<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MealPrep Buddy</title>
  <meta name="description" content="–¢–∏–∂–Ω–µ–≤–∏–π –ø–ª–∞–Ω —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è —Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫." />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <header class="site-header" id="top">
    <div class="container header-row">
      <a class="brand" href="#top" aria-label="–ù–∞ –ø–æ—á–∞—Ç–æ–∫">
        <span class="brand-mark">üç≤</span>
        <span class="brand-text">MealPrep Buddy</span>
      </a>

      <nav class="nav" aria-label="–ù–∞–≤—ñ–≥–∞—Ü—ñ—è">
        <a href="#planner">–ü–ª–∞–Ω —Ç–∏–∂–Ω—è</a>
        <a href="#shopping">–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</a>
      </nav>
    </div>
  </header>

  <main>
    <!-- HERO -->
    <section class="hero">
      <div class="container grid-2 hero-grid">
        <div>
          <h1>–ü–ª–∞–Ω—É–π —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å</h1>
          <p class="muted lead">
            –û–±–µ—Ä–∏ —Å—Ç—Ä–∞–≤–∏ –Ω–∞ –∫–æ–∂–µ–Ω –¥–µ–Ω—å. –Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ –¥–ª—è –≤—Å—ñ—Ö —Å—Ç—Ä–∞–≤ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å –∑–±–µ—Ä—É—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.
            –í—ñ–¥–º—ñ—á–∞–π, —â–æ –≤–∂–µ —î –≤–¥–æ–º–∞ ‚Äî —Ä–µ—à—Ç–∞ —Å—Ñ–æ—Ä–º—É—î—Ç—å—Å—è —É —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫.
          </p>

          <div class="hero-actions">
            <a class="btn" href="#planner">–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–ª–∞–Ω—É</a>
            <a class="btn" href="#shopping">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å–ø–∏—Å–æ–∫</a>
          </div>

          <ul class="hero-bullets">
            <li>7 –¥–Ω—ñ–≤ (–æ–±—ñ–¥ + –≤–µ—á–µ—Ä—è)</li>
            <li>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ –∑ –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫–æ–º –ø–æ–≤—Ç–æ—Ä—ñ–≤</li>
            <li>–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –≤ –æ–¥–∏–Ω –∫–ª—ñ–∫</li>
          </ul>
        </div>

        <div class="hero-image">
          <img src="images/mealprep-hero.jpg" alt="–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å" />
        </div>
      </div>
    </section>

    <!-- PLANNER -->
    <section class="section" id="planner">
      <div class="container">
        <div class="section-head">
          <div>
            <h2>–ü–ª–∞–Ω —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å</h2>
            <p class="muted">–ó–º—ñ–Ω–∏ —Å—Ç—Ä–∞–≤–∏ ‚Äî —Å–ø–∏—Å–æ–∫ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ —ñ –ø–æ–∫—É–ø–æ–∫ –æ–Ω–æ–≤–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.</p>
          </div>
          <button class="btn" id="buildBtn" type="button">–û–Ω–æ–≤–∏—Ç–∏</button>
        </div>

        <div class="card">
          <div class="planner-grid" id="plannerGrid" aria-label="–ü–ª–∞–Ω–µ—Ä —Ç–∏–∂–Ω—è"></div>
        </div>
      </div>
    </section>

    <!-- SHOPPING -->
    <section class="section" id="shopping">
      <div class="container">
        <div class="section-head">
          <div>
            <h2>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ —Ç–∞ —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</h2>
            <p class="muted">–í—ñ–¥–º—ñ—á–∞–π ¬´–≤–∂–µ —î¬ª ‚Äî —ñ –∑–∞–ª–∏—à–∞—Ç—å—Å—è –ª–∏—à–µ –ø–æ–∑–∏—Ü—ñ—ó –¥–ª—è –ø–æ–∫—É–ø–∫–∏.</p>
          </div>
        </div>

        <div class="grid-2">
          <div class="card">
            <h3>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å</h3>
            <div id="weeklyIngredients" class="checklist" aria-label="–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å"></div>

            <div class="actions">
              <button class="btn" id="markAllHaveBtn" type="button">–í–∂–µ —î –≤—Å–µ</button>
              <button class="btn" id="clearHaveBtn" type="button">–°–∫–∏–Ω—É—Ç–∏</button>
            </div>
          </div>

          <aside class="card">
            <h3>–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</h3>
            <div id="shoppingList" class="checklist" aria-label="–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫"></div>

            <div class="actions">
              <button class="btn" id="emailBtn" type="button">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –Ω–∞ email</button>
            </div>
          </aside>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-row">
      <span>¬© 2025 MealPrep Buddy</span>
    </div>
  </footer>

  <script>
    const MEALS = {
      "–°–∞–ª–∞—Ç –∑ —Ç—É–Ω—Ü–µ–º": ["–¢—É–Ω–µ—Ü—å (–∫–æ–Ω—Å–µ—Ä–≤–∞)", "–õ–∏—Å—Ç—è —Å–∞–ª–∞—Ç—É", "–û–≥—ñ—Ä–æ–∫", "–ü–æ–º—ñ–¥–æ—Ä–∏", "–û–ª–∏–≤–∫–æ–≤–∞ –æ–ª—ñ—è"],
      "–ü–∞—Å—Ç–∞ –∑ –æ–≤–æ—á–∞–º–∏": ["–ü–∞—Å—Ç–∞", "–ë–æ–ª–≥–∞—Ä—Å—å–∫–∏–π –ø–µ—Ä–µ—Ü—å", "–¶–∏–±—É–ª—è", "–ß–∞—Å–Ω–∏–∫", "–¢–æ–º–∞—Ç–Ω–∏–π —Å–æ—É—Å"],
      "–ì—Ä–µ—á–∫–∞ + –∫—É—Ä–∫–∞": ["–ì—Ä–µ—á–∫–∞", "–ö—É—Ä—è—á–µ —Ñ—ñ–ª–µ", "–°–ø–µ—Ü—ñ—ó"],
      "–û–≤–æ—á–µ–≤–∏–π —Å—É–ø": ["–ö–∞—Ä—Ç–æ–ø–ª—è", "–ú–æ—Ä–∫–≤–∞", "–¶–∏–±—É–ª—è", "–õ–∞–≤—Ä–æ–≤–∏–π –ª–∏—Å—Ç"],
      "–û–º–ª–µ—Ç –∑ —Å–∏—Ä–æ–º": ["–Ø–π—Ü—è", "–¢–≤–µ—Ä–¥–∏–π —Å–∏—Ä", "–ó–µ–ª–µ–Ω—å"],
      "–ó–∞–ø–µ—á–µ–Ω–∞ —Ä–∏–±–∞": ["–†–∏–±–∞", "–õ–∏–º–æ–Ω", "–°—ñ–ª—å", "–ü–µ—Ä–µ—Ü—å"],
      "–ß–∏–ª—ñ –∑ –∫–≤–∞—Å–æ–ª–µ—é": ["–ö–≤–∞—Å–æ–ª—è", "–¢–æ–º–∞—Ç–Ω–∏–π —Å–æ—É—Å", "–¶–∏–±—É–ª—è", "–°–ø–µ—Ü—ñ—ó"],
      "–°–∏—Ä–Ω–∏–∫–∏": ["–¢–≤–æ—Ä–æ–≥", "–Ø–π—Ü—è", "–ë–æ—Ä–æ—à–Ω–æ", "–¶—É–∫–æ—Ä"],
      "–°–º—É–∑—ñ –±–æ—É–ª": ["–ë–∞–Ω–∞–Ω", "–Ø–≥–æ–¥–∏", "–ô–æ–≥—É—Ä—Ç", "–í—ñ–≤—Å—è–Ω–∫–∞"],
      "–†–∏—Å –∑ –æ–≤–æ—á–∞–º–∏": ["–†–∏—Å", "–û–≤–æ—á–µ–≤–∞ —Å—É–º—ñ—à", "–°–æ—î–≤–∏–π —Å–æ—É—Å (–æ–ø—Ü.)"],
      "–ö—É—Å–∫—É—Å + –æ–≤–æ—á—ñ": ["–ö—É—Å–∫—É—Å", "–û–≤–æ—á–µ–≤–∞ —Å—É–º—ñ—à", "–û–ª–∏–≤–∫–æ–≤–∞ –æ–ª—ñ—è"],
      "–ô–æ–≥—É—Ä—Ç + —Ñ—Ä—É–∫—Ç–∏": ["–ô–æ–≥—É—Ä—Ç", "–§—Ä—É–∫—Ç–∏"]
    };

    const DAYS = [
      { key: "mon", label: "–ü–Ω" },
      { key: "tue", label: "–í—Ç" },
      { key: "wed", label: "–°—Ä" },
      { key: "thu", label: "–ß—Ç" },
      { key: "fri", label: "–ü—Ç" },
      { key: "sat", label: "–°–±" },
      { key: "sun", label: "–ù–¥" },
    ];

    const defaultPlan = {
      mon: { lunch: "–°–∞–ª–∞—Ç –∑ —Ç—É–Ω—Ü–µ–º", dinner: "–ü–∞—Å—Ç–∞ –∑ –æ–≤–æ—á–∞–º–∏" },
      tue: { lunch: "–ì—Ä–µ—á–∫–∞ + –∫—É—Ä–∫–∞", dinner: "–û–≤–æ—á–µ–≤–∏–π —Å—É–ø" },
      wed: { lunch: "–û–º–ª–µ—Ç –∑ —Å–∏—Ä–æ–º", dinner: "–†–∏—Å –∑ –æ–≤–æ—á–∞–º–∏" },
      thu: { lunch: "–ô–æ–≥—É—Ä—Ç + —Ñ—Ä—É–∫—Ç–∏", dinner: "–ó–∞–ø–µ—á–µ–Ω–∞ —Ä–∏–±–∞" },
      fri: { lunch: "–°–∞–ª–∞—Ç –∑ —Ç—É–Ω—Ü–µ–º", dinner: "–ß–∏–ª—ñ –∑ –∫–≤–∞—Å–æ–ª–µ—é" },
      sat: { lunch: "–°–∏—Ä–Ω–∏–∫–∏", dinner: "–ö—É—Å–∫—É—Å + –æ–≤–æ—á—ñ" },
      sun: { lunch: "–°–º—É–∑—ñ –±–æ—É–ª", dinner: "–ü–∞—Å—Ç–∞ –∑ –æ–≤–æ—á–∞–º–∏" }
    };

    const LS = { plan: "mpb_plan_final", have: "mpb_have_final" };

    function loadPlan(){
      try { return JSON.parse(localStorage.getItem(LS.plan)) || defaultPlan; }
      catch { return defaultPlan; }
    }
    function savePlan(plan){ localStorage.setItem(LS.plan, JSON.stringify(plan)); }

    function loadHave(){
      try { return JSON.parse(localStorage.getItem(LS.have)) || {}; }
      catch { return {}; }
    }
    function saveHave(have){ localStorage.setItem(LS.have, JSON.stringify(have)); }

    function normalizeKey(s){
      return s.toLowerCase().replace(/\s+/g, "_").replace(/[^\w–∞-—è—ñ—ó—î“ë_-]/gi, "");
    }

    function mealOptionsHTML(selected){
      const opts = Object.keys(MEALS)
        .sort((a,b)=>a.localeCompare(b,"uk"))
        .map(name => `<option value="${name}" ${name===selected ? "selected" : ""}>${name}</option>`)
        .join("");
      return `<option value="">‚Äî –æ–±—Ä–∞—Ç–∏ ‚Äî</option>${opts}`;
    }

    function renderPlanner(){
      const grid = document.getElementById("plannerGrid");
      const plan = loadPlan();
      grid.innerHTML = "";

      DAYS.forEach(d => {
        const row = document.createElement("div");
        row.className = "planner-row";
        row.innerHTML = `
          <div class="day">${d.label}</div>
          <div>
            <div class="muted small" style="margin-bottom:6px">–û–±—ñ–¥</div>
            <select data-day="${d.key}" data-slot="lunch" aria-label="–û–±—ñ–¥ ${d.label}">
              ${mealOptionsHTML(plan[d.key]?.lunch || "")}
            </select>
          </div>
          <div>
            <div class="muted small" style="margin-bottom:6px">–í–µ—á–µ—Ä—è</div>
            <select data-day="${d.key}" data-slot="dinner" aria-label="–í–µ—á–µ—Ä—è ${d.label}">
              ${mealOptionsHTML(plan[d.key]?.dinner || "")}
            </select>
          </div>
        `;
        grid.appendChild(row);
      });

      grid.querySelectorAll("select").forEach(sel => {
        sel.addEventListener("change", () => {
          const day = sel.getAttribute("data-day");
          const slot = sel.getAttribute("data-slot");
          const value = sel.value;

          const current = loadPlan();
          current[day] = current[day] || { lunch:"", dinner:"" };
          current[day][slot] = value;
          savePlan(current);

          buildWeeklyIngredients();
        });
      });
    }

    function getMealsFromPlan(plan){
      const selected = [];
      DAYS.forEach(d => {
        const day = plan[d.key] || {};
        if (day.lunch) selected.push(day.lunch);
        if (day.dinner) selected.push(day.dinner);
      });
      return selected;
    }

    function computeWeeklyIngredients(){
      const plan = loadPlan();
      const selectedMeals = getMealsFromPlan(plan);

      const map = new Map();
      selectedMeals.forEach(meal => {
        const ings = MEALS[meal];
        if (!ings) return;
        ings.forEach(ing => {
          if (!map.has(ing)) map.set(ing, { count: 1, key: normalizeKey(ing) });
          else map.get(ing).count += 1;
        });
      });

      return Array.from(map.entries())
        .map(([name, meta]) => ({ name, count: meta.count, key: meta.key }))
        .sort((a,b)=>a.name.localeCompare(b.name,"uk"));
    }

    function buildWeeklyIngredients(){
      const weekly = computeWeeklyIngredients();
      const have = loadHave();

      const weeklyEl = document.getElementById("weeklyIngredients");
      weeklyEl.innerHTML = "";

      weekly.forEach(item => {
        const checked = !!have[item.key];
        const row = document.createElement("label");
        row.innerHTML = `<input type="checkbox" data-key="${item.key}" ${checked ? "checked" : ""}> ${item.name} (√ó${item.count})`;
        row.querySelector("input").addEventListener("change", (e) => {
          const k = e.target.getAttribute("data-key");
          const updated = loadHave();
          updated[k] = e.target.checked;
          saveHave(updated);
          renderShoppingList();
        });
        weeklyEl.appendChild(row);
      });

      renderShoppingList();
    }

    function renderShoppingList(){
      const weekly = computeWeeklyIngredients();
      const have = loadHave();
      const shopping = weekly.filter(x => !have[x.key]);

      const shoppingEl = document.getElementById("shoppingList");
      shoppingEl.innerHTML = "";

      if (shopping.length === 0){
        const empty = document.createElement("div");
        empty.className = "muted";
        empty.textContent = "–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π.";
        shoppingEl.appendChild(empty);
        return;
      }

      shopping.forEach(item => {
        const row = document.createElement("div");
        row.textContent = `üõí ${item.name} (√ó${item.count})`;
        shoppingEl.appendChild(row);
      });
    }

    function buildEmailText(){
      const plan = loadPlan();
      const weekly = computeWeeklyIngredients();
      const have = loadHave();
      const toBuy = weekly.filter(x => !have[x.key]);

      const planLines = DAYS.map(d => {
        const day = plan[d.key] || {};
        const l = day.lunch || "‚Äî";
        const dn = day.dinner || "‚Äî";
        return `${d.label}: –û–±—ñ–¥ ‚Äî ${l}; –í–µ—á–µ—Ä—è ‚Äî ${dn}`;
      });

      const buyLines = toBuy.length
        ? toBuy.map(x => `- ${x.name} (√ó${x.count})`).join("\n")
        : "(–ù–µ–º–∞—î –ø–æ–∑–∏—Ü—ñ–π)";

      return `–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫\n\n–ü–ª–∞–Ω –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å:\n${planLines.join("\n")}\n\n–ö—É–ø–∏—Ç–∏:\n${buyLines}\n`;
    }

    document.getElementById("buildBtn").addEventListener("click", () => {
      buildWeeklyIngredients();
      document.getElementById("shopping").scrollIntoView({ behavior: "smooth" });
    });

    document.getElementById("clearHaveBtn").addEventListener("click", () => {
      localStorage.removeItem(LS.have);
      buildWeeklyIngredients();
    });

    document.getElementById("markAllHaveBtn").addEventListener("click", () => {
      const weekly = computeWeeklyIngredients();
      const have = {};
      weekly.forEach(x => { have[x.key] = true; });
      saveHave(have);
      buildWeeklyIngredients();
    });

    document.getElementById("emailBtn").addEventListener("click", () => {
      const subject = encodeURIComponent("–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫");
      const body = encodeURIComponent(buildEmailText());
      window.location.href = `mailto:?subject=${subject}&body=${body}`;
    });

    renderPlanner();
    buildWeeklyIngredients();
  </script>
</body>
</html>
