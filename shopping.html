<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MealPrep Buddy ‚Äî –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<header class="site-header">
  <div class="container header-row">
    <a class="brand" href="hero.html" aria-label="–ì–æ–ª–æ–≤–Ω–∞">üç≤ MealPrep Buddy</a>
    <nav class="nav" aria-label="–ù–∞–≤—ñ–≥–∞—Ü—ñ—è">
      <a href="hero.html">–ì–æ–ª–æ–≤–Ω–∞</a>
      <a href="planner.html">–ü–ª–∞–Ω —Ç–∏–∂–Ω—è</a>
      <a href="shopping.html" aria-current="page">–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</a>
    </nav>
  </div>
</header>

<main>
  <section class="section">
    <div class="container">
      <h2>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ —Ç–∞ —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</h2>
      <p class="muted">–°–ø–∏—Å–æ–∫ —Ñ–æ—Ä–º—É—î—Ç—å—Å—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ –≤–∏–±—Ä–∞–Ω–∏—Ö —Å—Ç—Ä–∞–≤ —É –ø–ª–∞–Ω—ñ —Ç–∏–∂–Ω—è –∞–±–æ –≤—Ä—É—á–Ω—É.</p>

      <div class="grid-2">
        <div class="card">
          <h3>–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å</h3>
          <div id="weeklyIngredients" class="checklist"></div>

          <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn" id="markAllHaveBtn" type="button">–í–∂–µ —î –≤—Å–µ</button>
            <button class="btn" id="clearHaveBtn" type="button">–°–∫–∏–Ω—É—Ç–∏ ¬´–≤–∂–µ —î¬ª</button>
          </div>
        </div>

        <div class="card">
          <h3>–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</h3>

          <!-- —Ä—É—á–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è -->
          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:12px;">
            <input id="manualItemInput" type="text" placeholder="–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä –≤—Ä—É—á–Ω—É‚Ä¶" style="flex:1; min-width:220px;">
            <button class="btn" id="addManualBtn" type="button">–î–æ–¥–∞—Ç–∏</button>
            <button class="btn" id="clearManualBtn" type="button">–û—á–∏—Å—Ç–∏—Ç–∏</button>
          </div>

          <div id="shoppingList" class="checklist"></div>

          <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
            <a class="btn" href="planner.html">–ù–∞–∑–∞–¥ –¥–æ –ø–ª–∞–Ω—É</a>
            <button class="btn" id="emailBtn" type="button">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –Ω–∞ email</button>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

<script>
  var LS_PLAN = "mpb_plan";
  var LS_HAVE = "mpb_have";
  var LS_MANUAL = "mpb_manual_list";

  var MEALS = {
    "–°–∞–ª–∞—Ç –∑ —Ç—É–Ω—Ü–µ–º": ["–¢—É–Ω–µ—Ü—å", "–õ–∏—Å—Ç—è —Å–∞–ª–∞—Ç—É", "–û–≥—ñ—Ä–æ–∫", "–ü–æ–º—ñ–¥–æ—Ä–∏", "–û–ª–∏–≤–∫–æ–≤–∞ –æ–ª—ñ—è"],
    "–ü–∞—Å—Ç–∞ –∑ –æ–≤–æ—á–∞–º–∏": ["–ü–∞—Å—Ç–∞", "–ë–æ–ª–≥–∞—Ä—Å—å–∫–∏–π –ø–µ—Ä–µ—Ü—å", "–¶–∏–±—É–ª—è", "–ß–∞—Å–Ω–∏–∫", "–¢–æ–º–∞—Ç–Ω–∏–π —Å–æ—É—Å"],
    "–ì—Ä–µ—á–∫–∞ + –∫—É—Ä–∫–∞": ["–ì—Ä–µ—á–∫–∞", "–ö—É—Ä—è—á–µ —Ñ—ñ–ª–µ", "–°–ø–µ—Ü—ñ—ó"],
    "–û–≤–æ—á–µ–≤–∏–π —Å—É–ø": ["–ö–∞—Ä—Ç–æ–ø–ª—è", "–ú–æ—Ä–∫–≤–∞", "–¶–∏–±—É–ª—è", "–õ–∞–≤—Ä–æ–≤–∏–π –ª–∏—Å—Ç"],
    "–û–º–ª–µ—Ç –∑ —Å–∏—Ä–æ–º": ["–Ø–π—Ü—è", "–¢–≤–µ—Ä–¥–∏–π —Å–∏—Ä", "–ó–µ–ª–µ–Ω—å"],
    "–ó–∞–ø–µ—á–µ–Ω–∞ —Ä–∏–±–∞": ["–†–∏–±–∞", "–õ–∏–º–æ–Ω", "–°—ñ–ª—å", "–ü–µ—Ä–µ—Ü—å"],
    "–ß–∏–ª—ñ –∑ –∫–≤–∞—Å–æ–ª–µ—é": ["–ö–≤–∞—Å–æ–ª—è", "–¢–æ–º–∞—Ç–Ω–∏–π —Å–æ—É—Å", "–¶–∏–±—É–ª—è", "–°–ø–µ—Ü—ñ—ó"],
    "–°–∏—Ä–Ω–∏–∫–∏": ["–¢–≤–æ—Ä–æ–≥", "–Ø–π—Ü—è", "–ë–æ—Ä–æ—à–Ω–æ", "–¶—É–∫–æ—Ä"],
    "–°–º—É–∑—ñ –±–æ—É–ª": ["–ë–∞–Ω–∞–Ω", "–Ø–≥–æ–¥–∏", "–ô–æ–≥—É—Ä—Ç", "–í—ñ–≤—Å—è–Ω–∫–∞"],
    "–†–∏—Å –∑ –æ–≤–æ—á–∞–º–∏": ["–†–∏—Å", "–û–≤–æ—á–µ–≤–∞ —Å—É–º—ñ—à", "–°–æ—î–≤–∏–π —Å–æ—É—Å (–æ–ø—Ü.)"],
    "–ö—É—Å–∫—É—Å + –æ–≤–æ—á—ñ": ["–ö—É—Å–∫—É—Å", "–û–≤–æ—á–µ–≤–∞ —Å—É–º—ñ—à", "–û–ª–∏–≤–∫–æ–≤–∞ –æ–ª—ñ—è"],
    "–ô–æ–≥—É—Ä—Ç + —Ñ—Ä—É–∫—Ç–∏": ["–ô–æ–≥—É—Ä—Ç", "–§—Ä—É–∫—Ç–∏"]
  };

  var DAYS = [
    {k:"mon", l:"–ü–Ω"},
    {k:"tue", l:"–í—Ç"},
    {k:"wed", l:"–°—Ä"},
    {k:"thu", l:"–ß—Ç"},
    {k:"fri", l:"–ü—Ç"},
    {k:"sat", l:"–°–±"},
    {k:"sun", l:"–ù–¥"}
  ];

  function safeParse(raw){
    try { return JSON.parse(raw); } catch(e) { return null; }
  }

  function loadPlan(){
    var raw = localStorage.getItem(LS_PLAN);
    if (!raw) return null;
    var parsed = safeParse(raw);
    if (!parsed) { localStorage.removeItem(LS_PLAN); return null; }
    return parsed;
  }

  function loadHave(){
    var raw = localStorage.getItem(LS_HAVE);
    if (!raw) return {};
    var parsed = safeParse(raw);
    if (!parsed) { localStorage.removeItem(LS_HAVE); return {}; }
    return parsed;
  }

  function saveHave(have){
    try { localStorage.setItem(LS_HAVE, JSON.stringify(have)); } catch(e) {}
  }

  function normalizeKey(s){
    return String(s).toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9–∞-—è—ñ—ó—î“ë_-]/gi,"");
  }

  function isEmptyPlan(p){
    if (!p) return true;
    for (var day in p){
      if (!p.hasOwnProperty(day)) continue;
      var v = p[day] || {};
      if (v.lunch || v.dinner) return false;
    }
    return true;
  }

  function addMeal(counts, mealName){
    if (!mealName) return;
    var ings = MEALS[mealName];
    if (!ings) return;
    for (var i=0;i<ings.length;i++){
      var ing = ings[i];
      var key = normalizeKey(ing);
      if (!counts[key]) counts[key] = { name: ing, key: key, count: 1 };
      else counts[key].count += 1;
    }
  }

  function computeWeeklyIngredients(plan){
    var counts = {};
    for (var i=0;i<DAYS.length;i++){
      var d = DAYS[i].k;
      var day = plan[d] || {};
      addMeal(counts, day.lunch);
      addMeal(counts, day.dinner);
    }
    var arr = [];
    for (var k in counts) if (counts.hasOwnProperty(k)) arr.push(counts[k]);
    arr.sort(function(a,b){ return a.name.localeCompare(b.name, "uk"); });
    return arr;
  }

  // ---------- manual list ----------
  function loadManual(){
    var raw = localStorage.getItem(LS_MANUAL);
    if (!raw) return [];
    var parsed = safeParse(raw);
    if (!Array.isArray(parsed)) { localStorage.removeItem(LS_MANUAL); return []; }
    return parsed;
  }

  function saveManual(arr){
    try { localStorage.setItem(LS_MANUAL, JSON.stringify(arr)); } catch(e) {}
  }

  function addManualItem(text){
    var t = String(text || "").trim();
    if (!t) return;
    var arr = loadManual();
    arr.push({ name: t, id: Date.now() + "_" + Math.random().toString(16).slice(2) });
    saveManual(arr);
  }

  function removeManualItem(id){
    var arr = loadManual().filter(function(x){ return x.id !== id; });
    saveManual(arr);
  }

  function render(){
    var weeklyEl = document.getElementById("weeklyIngredients");
    var shoppingEl = document.getElementById("shoppingList");
    if (!weeklyEl || !shoppingEl) return;

    var plan = loadPlan();
    var have = loadHave();

    // LEFT: weekly ingredients (from plan)
    if (!plan || isEmptyPlan(plan)){
      weeklyEl.innerHTML = "<div class='muted'>–ü–æ—Ä–æ–∂–Ω—å–æ. –°–ø–æ—á–∞—Ç–∫—É –∑–∞–ø–æ–≤–Ω—ñ—Ç—å <a href='planner.html'>–ü–ª–∞–Ω —Ç–∏–∂–Ω—è</a>.</div>";
    } else {
      var weekly = computeWeeklyIngredients(plan);
      weeklyEl.innerHTML = "";
      for (var i=0;i<weekly.length;i++){
        (function(item){
          var label = document.createElement("label");
          var checked = !!have[item.key];
          label.innerHTML =
            "<input type='checkbox' data-key='" + item.key + "'" + (checked ? " checked" : "") + "> " +
            item.name + " (√ó" + item.count + ")";
          var input = label.getElementsByTagName("input")[0];
          input.onchange = function(){
            var updated = loadHave();
            updated[item.key] = !!input.checked;
            saveHave(updated);
            render();
          };
          weeklyEl.appendChild(label);
        })(weekly[i]);
      }
    }

    // RIGHT: shopping list = (weekly - have) + manual
    shoppingEl.innerHTML = "";

    var any = false;

    // from plan
    if (plan && !isEmptyPlan(plan)){
      var weekly2 = computeWeeklyIngredients(plan);
      for (var j=0;j<weekly2.length;j++){
        if (!have[weekly2[j].key]){
          any = true;
          var row = document.createElement("div");
          row.appendChild(document.createTextNode("üõí " + weekly2[j].name + " (√ó" + weekly2[j].count + ")"));
          shoppingEl.appendChild(row);
        }
      }
    }

    // manual items
    var manual = loadManual();
    if (manual.length){
      any = true;
      var sep = document.createElement("div");
      sep.className = "muted";
      sep.style.marginTop = "10px";
      sep.textContent = "–í—Ä—É—á–Ω—É –¥–æ–¥–∞–Ω—ñ:";
      shoppingEl.appendChild(sep);

      for (var m=0;m<manual.length;m++){
        (function(item){
          var line = document.createElement("div");
          line.style.display = "flex";
          line.style.justifyContent = "space-between";
          line.style.gap = "10px";

          var left = document.createElement("span");
          left.textContent = "üõí " + item.name;

          var del = document.createElement("button");
          del.className = "btn";
          del.type = "button";
          del.textContent = "‚úï";
          del.onclick = function(){
            removeManualItem(item.id);
            render();
          };

          line.appendChild(left);
          line.appendChild(del);
          shoppingEl.appendChild(line);
        })(manual[m]);
      }
    }

    if (!any){
      shoppingEl.innerHTML = "<div class='muted'>–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π ‚Äî –¥–æ–¥–∞–π—Ç–µ —Å—Ç—Ä–∞–≤–∏ —É –ø–ª–∞–Ω—ñ –∞–±–æ –¥–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä–∏ –≤—Ä—É—á–Ω—É üôÇ</div>";
    }
  }

  function buildEmailText(){
    var lines = [];
    var plan = loadPlan();
    var have = loadHave();

    if (plan && !isEmptyPlan(plan)){
      var weekly = computeWeeklyIngredients(plan);
      for (var i=0;i<weekly.length;i++){
        if (!have[weekly[i].key]) lines.push("- " + weekly[i].name + " (√ó" + weekly[i].count + ")");
      }
    }

    var manual = loadManual();
    if (manual.length){
      lines.push("");
      lines.push("–í—Ä—É—á–Ω—É –¥–æ–¥–∞–Ω—ñ:");
      for (var m=0;m<manual.length;m++){
        lines.push("- " + manual[m].name);
      }
    }

    if (!lines.length) lines.push("(–ù–µ–º–∞—î –ø–æ–∑–∏—Ü—ñ–π ‚Äî –≤—Å–µ –≤–∂–µ —î)");

    return "–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫:\n\n" + lines.join("\n");
  }

  // buttons
  var clearHaveBtn = document.getElementById("clearHaveBtn");
  if (clearHaveBtn){
    clearHaveBtn.onclick = function(){
      localStorage.removeItem(LS_HAVE);
      render();
    };
  }

  var markAllHaveBtn = document.getElementById("markAllHaveBtn");
  if (markAllHaveBtn){
    markAllHaveBtn.onclick = function(){
      var plan = loadPlan();
      if (!plan || isEmptyPlan(plan)) return;
      var weekly = computeWeeklyIngredients(plan);
      var have = {};
      for (var i=0;i<weekly.length;i++) have[weekly[i].key] = true;
      saveHave(have);
      render();
    };
  }

  var emailBtn = document.getElementById("emailBtn");
  if (emailBtn){
    emailBtn.onclick = function(){
      var subject = encodeURIComponent("–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫");
      var body = encodeURIComponent(buildEmailText());
      window.location.href = "mailto:?subject=" + subject + "&body=" + body;
    };
  }

  var addManualBtn = document.getElementById("addManualBtn");
  var manualItemInput = document.getElementById("manualItemInput");
  if (addManualBtn && manualItemInput){
    addManualBtn.onclick = function(){
      addManualItem(manualItemInput.value);
      manualItemInput.value = "";
      render();
    };
    manualItemInput.addEventListener("keydown", function(e){
      if (e.key === "Enter"){
        addManualItem(manualItemInput.value);
        manualItemInput.value = "";
        render();
      }
    });
  }

  var clearManualBtn = document.getElementById("clearManualBtn");
  if (clearManualBtn){
    clearManualBtn.onclick = function(){
      localStorage.removeItem(LS_MANUAL);
      render();
    };
  }

  render();
</script>

<footer class="site-footer">
  <div class="container">
    –ö–æ–Ω—Ç–∞–∫—Ç–∏: <a href="mailto:contact@example.com">contact@example.com</a>
  </div>
</footer>

</body>
</html>
